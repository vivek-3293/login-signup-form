import axios from "axios";
import { refreshAccessToken } from "./AuthContext"; // Import the refresh logic

// Add a request interceptor
axios.interceptors.response.use(
  (response) => {
    // If the response is successful, simply return it
    return response;
  },
  async (error) => {
    // If the error response is 401, handle token refresh
    if (error.response?.status === 401) {
      try {
        // Call the refreshAccessToken function
        const newToken = await refreshAccessToken();

        if (newToken) {
          // Update the Authorization header and retry the failed request
          error.config.headers["Authorization"] = `Bearer ${newToken}`;
          return axios.request(error.config);
        }
      } catch (refreshError) {
        // If token refresh fails, log out the user or take necessary action
        console.error("Token refresh failed:", refreshError);
      }
    }

    // Return the error if it's not a 401 or refresh fails
    throw error;
  }
);
